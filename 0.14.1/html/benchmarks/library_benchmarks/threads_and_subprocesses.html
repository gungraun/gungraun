<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Multi-threaded and multi-process applications - Iai-Callgrind Guide</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="Iai-Callgrind, a high-precision and consistent one-shot benchmarking framework/harness for Rust">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../css/my.css">
        <link rel="stylesheet" href="../../css/dropdown.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../getting_help.html"><strong aria-hidden="true">2.</strong> Getting Help</a></li><li class="chapter-item expanded affix "><li class="part-title">Installation</li><li class="chapter-item expanded "><a href="../../installation/prerequisites.html"><strong aria-hidden="true">3.</strong> Prerequisites</a></li><li class="chapter-item expanded "><a href="../../installation/iai_callgrind.html"><strong aria-hidden="true">4.</strong> Iai-Callgrind</a></li><li class="chapter-item expanded affix "><li class="part-title">Benchmarks</li><li class="chapter-item expanded "><a href="../../benchmarks/overview.html"><strong aria-hidden="true">5.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../../benchmarks/library_benchmarks.html"><strong aria-hidden="true">6.</strong> Library Benchmarks</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../benchmarks/library_benchmarks/important.html"><strong aria-hidden="true">6.1.</strong> Important default behaviour</a></li><li class="chapter-item expanded "><a href="../../benchmarks/library_benchmarks/quickstart.html"><strong aria-hidden="true">6.2.</strong> Quickstart</a></li><li class="chapter-item expanded "><a href="../../benchmarks/library_benchmarks/anatomy.html"><strong aria-hidden="true">6.3.</strong> Anatomy of a library benchmark</a></li><li class="chapter-item expanded "><a href="../../benchmarks/library_benchmarks/macros.html"><strong aria-hidden="true">6.4.</strong> The macros in more detail</a></li><li class="chapter-item expanded "><a href="../../benchmarks/library_benchmarks/setup_and_teardown.html"><strong aria-hidden="true">6.5.</strong> setup and teardown</a></li><li class="chapter-item expanded "><a href="../../benchmarks/library_benchmarks/multiple_benches.html"><strong aria-hidden="true">6.6.</strong> Specify multiple benches at once</a></li><li class="chapter-item expanded "><a href="../../benchmarks/library_benchmarks/generic.html"><strong aria-hidden="true">6.7.</strong> Generic benchmark functions</a></li><li class="chapter-item expanded "><a href="../../benchmarks/library_benchmarks/compare_by_id.html"><strong aria-hidden="true">6.8.</strong> Comparing benchmark functions</a></li><li class="chapter-item expanded "><a href="../../benchmarks/library_benchmarks/configuration.html"><strong aria-hidden="true">6.9.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="../../benchmarks/library_benchmarks/custom_entry_point.html"><strong aria-hidden="true">6.10.</strong> Custom entry points</a></li><li class="chapter-item expanded "><a href="../../benchmarks/library_benchmarks/threads_and_subprocesses.html" class="active"><strong aria-hidden="true">6.11.</strong> Multi-threaded and multi-process applications</a></li><li class="chapter-item expanded "><a href="../../benchmarks/library_benchmarks/examples.html"><strong aria-hidden="true">6.12.</strong> More Examples, please!</a></li></ol></li><li class="chapter-item expanded "><a href="../../benchmarks/binary_benchmarks.html"><strong aria-hidden="true">7.</strong> Binary Benchmarks</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../benchmarks/binary_benchmarks/important.html"><strong aria-hidden="true">7.1.</strong> Important default behaviour</a></li><li class="chapter-item expanded "><a href="../../benchmarks/binary_benchmarks/quickstart.html"><strong aria-hidden="true">7.2.</strong> Quickstart</a></li><li class="chapter-item expanded "><a href="../../benchmarks/binary_benchmarks/differences.html"><strong aria-hidden="true">7.3.</strong> Differences to library benchmarks</a></li><li class="chapter-item expanded "><a href="../../benchmarks/binary_benchmarks/stdin_and_pipe.html"><strong aria-hidden="true">7.4.</strong> The Command's stdin and simulating piped input</a></li><li class="chapter-item expanded "><a href="../../benchmarks/binary_benchmarks/configuration.html"><strong aria-hidden="true">7.5.</strong> Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../benchmarks/binary_benchmarks/configuration/delay.html"><strong aria-hidden="true">7.5.1.</strong> Delay the Command</a></li><li class="chapter-item expanded "><a href="../../benchmarks/binary_benchmarks/configuration/sandbox.html"><strong aria-hidden="true">7.5.2.</strong> Sandbox</a></li><li class="chapter-item expanded "><a href="../../benchmarks/binary_benchmarks/configuration/exit_code.html"><strong aria-hidden="true">7.5.3.</strong> Configure the exit code of the Command</a></li></ol></li><li class="chapter-item expanded "><a href="../../benchmarks/binary_benchmarks/low_level.html"><strong aria-hidden="true">7.6.</strong> Low-level api</a></li><li class="chapter-item expanded "><a href="../../benchmarks/binary_benchmarks/examples.html"><strong aria-hidden="true">7.7.</strong> More examples needed?</a></li></ol></li><li class="chapter-item expanded "><a href="../../regressions.html"><strong aria-hidden="true">8.</strong> Performance Regressions</a></li><li class="chapter-item expanded "><a href="../../tools.html"><strong aria-hidden="true">9.</strong> Other Valgrind Tools</a></li><li class="chapter-item expanded "><a href="../../client_requests.html"><strong aria-hidden="true">10.</strong> Valgrind Client Requests</a></li><li class="chapter-item expanded "><a href="../../flamegraphs.html"><strong aria-hidden="true">11.</strong> Callgrind Flamegraphs</a></li><li class="chapter-item expanded affix "><li class="part-title">Command-line and environment variables</li><li class="chapter-item expanded "><a href="../../cli_and_env/basics.html"><strong aria-hidden="true">12.</strong> Basic usage</a></li><li class="chapter-item expanded "><a href="../../cli_and_env/baselines.html"><strong aria-hidden="true">13.</strong> Comparing with baselines</a></li><li class="chapter-item expanded "><a href="../../cli_and_env/output.html"><strong aria-hidden="true">14.</strong> Controlling the output of Iai-Callgrind</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../cli_and_env/output/out_directory.html"><strong aria-hidden="true">14.1.</strong> Customize the output directory</a></li><li class="chapter-item expanded "><a href="../../cli_and_env/output/machine_readable.html"><strong aria-hidden="true">14.2.</strong> Machine-readable output</a></li><li class="chapter-item expanded "><a href="../../cli_and_env/output/terminal_output.html"><strong aria-hidden="true">14.3.</strong> Showing terminal output of benchmarks</a></li><li class="chapter-item expanded "><a href="../../cli_and_env/output/color.html"><strong aria-hidden="true">14.4.</strong> Changing the color output</a></li><li class="chapter-item expanded "><a href="../../cli_and_env/output/logging.html"><strong aria-hidden="true">14.5.</strong> Changing the logging output</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Troubleshooting</li><li class="chapter-item expanded "><a href="../../troubleshooting/im-getting-the-error-sentinel-not-found.html"><strong aria-hidden="true">15.</strong> I'm getting the error Sentinel ... not found</a></li><li class="chapter-item expanded "><a href="../../troubleshooting/running-cargo-bench-results-in-an-unrecognized-option-error.html"><strong aria-hidden="true">16.</strong> Running cargo bench results in an "Unrecognized Option" error</a></li><li class="chapter-item expanded affix "><li class="part-title">Comparison</li><li class="chapter-item expanded "><a href="../../comparison/criterion.html"><strong aria-hidden="true">17.</strong> Criterion</a></li><li class="chapter-item expanded "><a href="../../comparison/iai.html"><strong aria-hidden="true">18.</strong> Iai</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        <div class="dropdown">
                          <button onclick="versionDropdown()" class="icon-button version-dropdown-button" type="button">Version</button>
                          <div id="version-dropdown" class="version-dropdown-content">
                            <a href="../../../../latest/html/index.html">Latest</a>
                            <hr class="sidbar-spacer">
                            <script src="../../../../versions.js"></script>
                          </div>
                        </div>
                    </div>

                    <h1 class="menu-title">Iai-Callgrind Guide</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/iai-callgrind/iai-callgrind" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/iai-callgrind/iai-callgrind/master/docs/src/benchmarks/library_benchmarks/threads_and_subprocesses.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- markdownlint-disable MD025 MD042 MD033 -->
<h1 id="multi-threaded-and-multi-process-applications"><a class="header" href="#multi-threaded-and-multi-process-applications">Multi-threaded and multi-process applications</a></h1>
<p>The default is to run Iai-Callgrind benchmarks with <code>--separate-threads=yes</code>,
<code>--trace-children=yes</code> switched on. This enables Iai-Callgrind to trace threads
and subprocesses, respectively. Note that <code>--separate-threads=yes</code> is not
strictly necessary to be able to trace threads. But, if they are separated,
Iai-Callgrind can collect and display the metrics for each thread. Due to the
way <code>callgrind</code> applies <a href="https://valgrind.org/docs/manual/cl-manual.html#cl-manual.options.collection">data collection options</a> like <code>--toggle-collect</code>,
<code>--collect-atstart</code>, ... further configuration is needed in library benchmarks.</p>
<p>To actually see the collected metrics in the terminal output for all threads
and/or subprocesses you can switch on <code>OutputFormat::show_intermediate</code>:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">extern crate iai_callgrind;
</span><span class="boring">mod my_lib { pub fn find_primes_multi_thread(_: u64) -&gt; Vec&lt;u64&gt; { vec![]} }
</span>use iai_callgrind::{
    main, library_benchmark_group, library_benchmark, LibraryBenchmarkConfig,
    OutputFormat
};
use std::hint::black_box;

#[library_benchmark]
fn bench_threads() -&gt; Vec&lt;u64&gt; {
    black_box(my_lib::find_primes_multi_thread(2))
}

library_benchmark_group!(name = my_group; benchmarks = bench_threads);
<span class="boring">fn main() {
</span>main!(
    config = LibraryBenchmarkConfig::default()
        .output_format(OutputFormat::default()
            .show_intermediate(true)
        );
    library_benchmark_groups = my_group
);
<span class="boring">}</span></code></pre></pre>
<p>The best method for benchmarking threads and subprocesses depends heavily on
your code. So, rather than suggesting a single "best" method for benchmarking
threads and subprocesses, this chapter will run through various possible
approaches and try to highlight the pros and cons of each.</p>
<h2 id="multi-threaded-applications"><a class="header" href="#multi-threaded-applications">Multi-threaded applications</a></h2>
<p><code>Callgrind</code> treats each thread and process as a separate unit and it applies
data collection options to each unit. In library benchmarks the <a href="./custom_entry_point.html">entry
point</a> (or the default toggle) for <code>callgrind</code> is per
default set to the benchmark function with the help of the <code>--toggle-collect</code>
option. Setting <code>--toggle-collect</code> also automatically sets
<code>--collect-atstart=no</code>. If not further customized for a benchmarked
multi-threaded function, these options cause the metrics for the spawned threads
to be zero. This happens since each thread is a separate unit with
<code>--collect-atstart=no</code> and the default toggle applied to the units. The default
toggle is set to the benchmark function and does not hook into any function in
the thread, so the metrics are zero.</p>
<p>There are multiple ways to customize the default behaviour and actually measure
the threads. For the following examples, we're using the benchmark and library
code below to show the different customization options assuming this code lives
in a benchmark file <code>benches/lib_bench_threads.rs</code></p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">extern crate iai_callgrind;
</span>use iai_callgrind::{
    main, library_benchmark_group, library_benchmark, LibraryBenchmarkConfig,
    OutputFormat
};
use std::hint::black_box;

/// Suppose this is your library
pub mod my_lib {
    /// Return true if `num` is a prime number
    pub fn is_prime(num: u64) -&gt; bool {
        if num &lt;= 1 {
            return false;
        }

        for i in 2..=(num as f64).sqrt() as u64 {
            if num % i == 0 {
                return false;
            }
        }

        true
    }

    /// Find and return all prime numbers in the inclusive range `low` to `high`
    pub fn find_primes(low: u64, high: u64) -&gt; Vec&lt;u64&gt; {
        (low..=high).filter(|n| is_prime(*n)).collect()
    }

    /// Return the prime numbers in the range `0..(num_threads * 10000)`
    pub fn find_primes_multi_thread(num_threads: usize) -&gt; Vec&lt;u64&gt; {
        let mut handles = vec![];
        let mut low = 0;
        for _ in 0..num_threads {
            let handle = std::thread::spawn(move || find_primes(low, low + 10000));
            handles.push(handle);

            low += 10000;
        }

        let mut primes = vec![];
        for handle in handles {
            let result = handle.join();
            primes.extend(result.unwrap())
        }

        primes
    }
}

#[library_benchmark]
#[bench::two_threads(2)]
fn bench_threads(num_threads: usize) -&gt; Vec&lt;u64&gt; {
    black_box(my_lib::find_primes_multi_thread(num_threads))
}

library_benchmark_group!(name = my_group; benchmarks = bench_threads);
<span class="boring">fn main() {
</span>main!(
    config = LibraryBenchmarkConfig::default()
        .output_format(OutputFormat::default()
            .show_intermediate(true)
        );
    library_benchmark_groups = my_group
);
<span class="boring">}</span></code></pre></pre>
<p>Running this benchmark with <code>cargo bench</code> will present you with the following
terminal output:</p>
<pre><code class="hljs"><span style="color:#0A0">lib_bench_threads::my_group::bench_threads</span> <span style="color:#0AA">two_threads</span><span style="color:#0AA">:</span><b><span style="color:#00A">2</span></b>
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 2097219 thread: 1 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_threads-b85159a94ccb3851</span></b>
<span style="color:#555">  </span>Instructions:                       <b>27305</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                            <b>66353</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                              <b>341</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>539</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                   <b>67233</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                   <b>86923</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 2097219 thread: 2 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_threads-b85159a94ccb3851</span></b>
<span style="color:#555">  </span>Instructions:                           <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                                <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                                <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                               <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                       <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                       <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 2097219 thread: 3 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_threads-b85159a94ccb3851</span></b>
<span style="color:#555">  </span>Instructions:                           <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                                <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                                <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                               <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                       <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                       <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>Total</b>
<span style="color:#555">  </span>Instructions:                       <b>27305</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                            <b>66353</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                              <b>341</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>539</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                   <b>67233</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                   <b>86923</b>|N/A                  (<span style="color:#555">*********</span>)</code></pre>
<p>As you can see, the counts for the threads <code>2</code> and <code>3</code> (our spawned threads) are
all zero.</p>
<h3 id="measuring-threads-using-toggles"><a class="header" href="#measuring-threads-using-toggles">Measuring threads using toggles</a></h3>
<p>At a first glance, setting a toggle to the function in the thread seems to be
easiest way and can be done like so:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">extern crate iai_callgrind;
</span><span class="boring">mod my_lib { pub fn find_primes_multi_thread(_: usize) -&gt; Vec&lt;u64&gt; { vec![] }}
</span>use iai_callgrind::{
    main, library_benchmark_group, library_benchmark, LibraryBenchmarkConfig,
    EntryPoint
};
use std::hint::black_box;

#[library_benchmark(
    config = LibraryBenchmarkConfig::default()
        .callgrind_args(["--toggle-collect=lib_bench_threads::my_lib::find_primes"])
)]
#[bench::two_threads(2)]
fn bench_threads(num_threads: usize) -&gt; Vec&lt;u64&gt; {
    black_box(my_lib::find_primes_multi_thread(num_threads))
}
<span class="boring">library_benchmark_group!(name = my_group; benchmarks = bench_threads);
</span><span class="boring">fn main() {
</span><span class="boring">main!(library_benchmark_groups = my_group);
</span><span class="boring">}</span></code></pre></pre>
<p>This approach may or may not work, depending on whether the compiler inlines the
target function of the <code>--toggle-collect</code> argument or not. This is the same
problem as with <a href="./custom_entry_point.html#pitfall-inlined-functions">custom entry
points</a>. As can be seen
below, the compiler has chosen to inline <code>find_primes</code> and the metrics for the
threads are still zero:</p>
<pre><code class="hljs"><span style="color:#0A0">lib_bench_threads::my_group::bench_threads</span> <span style="color:#0AA">two_threads</span><span style="color:#0AA">:</span><b><span style="color:#00A">2</span></b>
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 2620776 thread: 1 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_threads-b85159a94ccb3851</span></b>
<span style="color:#555">  </span>Instructions:                       <b>27372</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                            <b>66431</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                              <b>343</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>538</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                   <b>67312</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                   <b>86976</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 2620776 thread: 2 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_threads-b85159a94ccb3851</span></b>
<span style="color:#555">  </span>Instructions:                           <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                                <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                                <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                               <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                       <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                       <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 2620776 thread: 3 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_threads-b85159a94ccb3851</span></b>
<span style="color:#555">  </span>Instructions:                           <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                                <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                                <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                               <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                       <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                       <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>Total</b>
<span style="color:#555">  </span>Instructions:                       <b>27372</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                            <b>66431</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                              <b>343</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>538</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                   <b>67312</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                   <b>86976</b>|N/A                  (<span style="color:#555">*********</span>)</code></pre>
<p>Just to show what would happen if the compiler does not inline the <code>find_primes</code>
method, we temporarily annotate it with <code>#[inline(never)]</code>:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Find and return all prime numbers in the inclusive range `low` to `high`
<span class="boring">fn is_prime(_: u64) -&gt; bool { true }
</span>#[inline(never)]
pub fn find_primes(low: u64, high: u64) -&gt; Vec&lt;u64&gt; {
    (low..=high).filter(|n| is_prime(*n)).collect()
}
<span class="boring">}</span></code></pre></pre>
<p>Now, running the benchmark does show the desired metrics:</p>
<pre><code class="hljs"><span style="color:#0A0">lib_bench_threads::my_group::bench_threads</span> <span style="color:#0AA">two_threads</span><span style="color:#0AA">:</span><b><span style="color:#00A">2</span></b>
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 2661917 thread: 1 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_threads-b85159a94ccb3851</span></b>
<span style="color:#555">  </span>Instructions:                       <b>27372</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                            <b>66431</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                              <b>343</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>538</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                   <b>67312</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                   <b>86976</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 2661917 thread: 2 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_threads-b85159a94ccb3851</span></b>
<span style="color:#555">  </span>Instructions:                     <b>2460503</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                          <b>2534938</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                               <b>12</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>186</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                 <b>2535136</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                 <b>2541508</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 2661917 thread: 3 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_threads-b85159a94ccb3851</span></b>
<span style="color:#555">  </span>Instructions:                     <b>3650410</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                          <b>3724286</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                                <b>4</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>130</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                 <b>3724420</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                 <b>3728856</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>Total</b>
<span style="color:#555">  </span>Instructions:                     <b>6138285</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                          <b>6325655</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                              <b>359</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>854</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                 <b>6326868</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                 <b>6357340</b>|N/A                  (<span style="color:#555">*********</span>)</code></pre>
<p>But, annotating functions with <code>#[inline(never)]</code> in production code is usually
not an option and preventing the compiler from doing its job is not the
preferred way to make a benchmark work. The truth is, there is no way to make
the <code>--toggle-collect</code> argument work for all cases and it heavily depends on the
choices of the compiler depending on your code.</p>
<p>Another way to get the thread metrics is to set <code>--collect-atstart=yes</code> and turn
off the <code>EntryPoint</code>:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">extern crate iai_callgrind;
</span><span class="boring">mod my_lib { pub fn find_primes_multi_thread(_: usize) -&gt; Vec&lt;u64&gt; { vec![] }}
</span>use iai_callgrind::{
    main, library_benchmark_group, library_benchmark, LibraryBenchmarkConfig,
    EntryPoint
};
use std::hint::black_box;

#[library_benchmark(
    config = LibraryBenchmarkConfig::default()
        .entry_point(EntryPoint::None)
        .callgrind_args(["--collect-atstart=yes"])
)]
#[bench::two_threads(2)]
fn bench_threads(num_threads: usize) -&gt; Vec&lt;u64&gt; {
    black_box(my_lib::find_primes_multi_thread(num_threads))
}
<span class="boring">library_benchmark_group!(name = my_group; benchmarks = bench_threads);
</span><span class="boring">fn main() {
</span><span class="boring">main!(library_benchmark_groups = my_group);
</span><span class="boring">}</span></code></pre></pre>
<p>But, the metrics of the main thread will include all the setup (and teardown)
code from the benchmark executable (so the instructions of the main thread go up
from <code>27372</code> to <code>404425</code>):</p>
<pre><code class="hljs"><span style="color:#0A0">lib_bench_threads::my_group::bench_threads</span> <span style="color:#0AA">two_threads</span><span style="color:#0AA">:</span><b><span style="color:#00A">2</span></b>
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 2697019 thread: 1 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_threads-b85159a94ccb3851</span></b>
<span style="color:#555">  </span>Instructions:                      <b>404425</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                           <b>570186</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                             <b>1307</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                            <b>4856</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                  <b>576349</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                  <b>746681</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 2697019 thread: 2 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_threads-b85159a94ccb3851</span></b>
<span style="color:#555">  </span>Instructions:                     <b>2466864</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                          <b>2543314</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                               <b>81</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>409</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                 <b>2543804</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                 <b>2558034</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 2697019 thread: 3 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_threads-b85159a94ccb3851</span></b>
<span style="color:#555">  </span>Instructions:                     <b>3656729</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                          <b>3732802</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                               <b>31</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>201</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                 <b>3733034</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                 <b>3739992</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>Total</b>
<span style="color:#555">  </span>Instructions:                     <b>6528018</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                          <b>6846302</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                             <b>1419</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                            <b>5466</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                 <b>6853187</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                 <b>7044707</b>|N/A                  (<span style="color:#555">*********</span>)</code></pre>
<p>Additionally, expect a lot of metric changes if the benchmarks itself are
changed. However, if the metrics of the main thread are not significant compared
to the total, this might be an applicable (last) choice.</p>
<p>There is another more reliable way as shown below in the next section.</p>
<h3 id="measuring-threads-using-client-requests"><a class="header" href="#measuring-threads-using-client-requests">Measuring threads using client requests</a></h3>
<p>The perhaps most reliable and flexible way to measure threads is using <a href="../../client_requests.html">client
requests</a>. The downside is that you have to put some
benchmark code into your production code. But, if you followed the installation
instructions in <a href="../../client_requests.html">client requests</a>, this additional
code is only compiled in benchmarks, not in your final production-ready library.</p>
<p>Using the callgrind client request, we adjust the threads in the
<code>find_primes_multi_thread</code> function like so:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn find_primes(_a: u64, _b: u64) -&gt; Vec&lt;u64&gt; { vec![] }
</span><span class="boring">extern crate iai_callgrind;
</span>use iai_callgrind::client_requests::callgrind;

/// Return the prime numbers in the range `0..(num_threads * 10000)`
pub fn find_primes_multi_thread(num_threads: usize) -&gt; Vec&lt;u64&gt; {
    let mut handles = vec![];
    let mut low = 0;
    for _ in 0..num_threads {
        let handle = std::thread::spawn(move || {
            callgrind::toggle_collect();
            let result = find_primes(low, low + 10000);
            callgrind::toggle_collect();
            result
        });
        handles.push(handle);

        low += 10000;
    }

    let mut primes = vec![];
    for handle in handles {
        let result = handle.join();
        primes.extend(result.unwrap())
    }

    primes
}
<span class="boring">}</span></code></pre></pre>
<p>and running the same benchmark now will show the collected metrics of the
threads:</p>
<pre><code class="hljs"><span style="color:#0A0">lib_bench_threads::my_group::bench_threads</span> <span style="color:#0AA">two_threads</span><span style="color:#0AA">:</span><b><span style="color:#00A">2</span></b>
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 2149242 thread: 1 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_threads-b85159a94ccb3851</span></b>
<span style="color:#555">  </span>Instructions:                       <b>27305</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                            <b>66352</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                              <b>344</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>537</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                   <b>67233</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                   <b>86867</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 2149242 thread: 2 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_threads-b85159a94ccb3851</span></b>
<span style="color:#555">  </span>Instructions:                     <b>2460501</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                          <b>2534935</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                               <b>13</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>185</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                 <b>2535133</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                 <b>2541475</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 2149242 thread: 3 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_threads-b85159a94ccb3851</span></b>
<span style="color:#555">  </span>Instructions:                     <b>3650408</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                          <b>3724285</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                                <b>1</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>131</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                 <b>3724417</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                 <b>3728875</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>Total</b>
<span style="color:#555">  </span>Instructions:                     <b>6138214</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                          <b>6325572</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                              <b>358</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>853</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                 <b>6326783</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                 <b>6357217</b>|N/A                  (<span style="color:#555">*********</span>)</code></pre>
<p>Using the client request toggles is very flexible since you can put the
<code>iai_callgrind::client_requests::callgrind::toggle_collect</code> instructions
anywhere in the threads. In this example, we just have a single function in the
thread, but if your threads consist of more than just a single function, you can
easily exclude uninteresting parts from the final measurements.</p>
<p>If you want to prevent the code of the main thread from being measured, you can
use the following:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">extern crate iai_callgrind;
</span><span class="boring">mod my_lib { pub fn find_primes_multi_thread(_: usize) -&gt; Vec&lt;u64&gt; { vec![] }}
</span>use iai_callgrind::{
    main, library_benchmark_group, library_benchmark, LibraryBenchmarkConfig,
    EntryPoint
};
use std::hint::black_box;

#[library_benchmark(
    config = LibraryBenchmarkConfig::default()
        .entry_point(EntryPoint::None)
        .callgrind_args(["--collect-atstart=no"])
)]
#[bench::two_threads(2)]
fn bench_threads(num_threads: usize) -&gt; Vec&lt;u64&gt; {
    black_box(my_lib::find_primes_multi_thread(num_threads))
}
<span class="boring">library_benchmark_group!(name = my_group; benchmarks = bench_threads);
</span><span class="boring">fn main() {
</span><span class="boring">main!(library_benchmark_groups = my_group);
</span><span class="boring">}</span></code></pre></pre>
<p>Setting the <code>EntryPoint::None</code> disables the default toggle but also
<code>--collect-atstart=no</code>, which is why we have to set the option manually.
Altogether, running the benchmark will show:</p>
<pre><code class="hljs"><span style="color:#0A0">lib_bench_threads::my_group::bench_threads</span> <span style="color:#0AA">two_threads</span><span style="color:#0AA">:</span><b><span style="color:#00A">2</span></b>
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 2251257 thread: 1 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_threads-b85159a94ccb3851</span></b>
<span style="color:#555">  </span>Instructions:                           <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                                <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                                <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                               <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                       <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                       <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 2251257 thread: 2 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_threads-b85159a94ccb3851</span></b>
<span style="color:#555">  </span>Instructions:                     <b>2460501</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                          <b>2534935</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                               <b>11</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>187</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                 <b>2535133</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                 <b>2541535</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 2251257 thread: 3 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_threads-b85159a94ccb3851</span></b>
<span style="color:#555">  </span>Instructions:                     <b>3650408</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                          <b>3724282</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                                <b>4</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>131</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                 <b>3724417</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                 <b>3728887</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>Total</b>
<span style="color:#555">  </span>Instructions:                     <b>6110909</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                          <b>6259217</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                               <b>15</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>318</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                 <b>6259550</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                 <b>6270422</b>|N/A                  (<span style="color:#555">*********</span>)</code></pre>
<h2 id="multi-process-applications"><a class="header" href="#multi-process-applications">Multi-process applications</a></h2>
<p>Measuring multi-process applications is in principal not that different from
multi-threaded applications since subprocesses are just like threads separate
units. As for threads, the <a href="https://valgrind.org/docs/manual/cl-manual.html#cl-manual.options.collection">data collection options</a> are applied to subprocesses
separately from the main process.</p>
<p>Note there are multiple <a href="https://valgrind.org/docs/manual/manual-core.html#manual-core.basicopts">valgrind command-line
arguments</a>
that can disable the collection of metrics for uninteresting subprocesses, for
example subprocesses that are spawned by your library function but are not part
of your library/binary crate.</p>
<p>For the following examples suppose the code below is the <code>cat</code> binary and part
of a crate (so we can use
<a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-sets-for-crates"><code>env!("CARGO_BIN_EXE_cat")</code></a>):</p>
<pre><pre class="playground"><code class="language-rust edition2021">use std::fs::File;
use std::io::{copy, stdout, BufReader, BufWriter, Write};

<span class="boring">fn main() {
</span>fn main() {
    let mut args_iter = std::env::args().skip(1);
    let file_arg = args_iter.next().expect("File argument should be present");

    let file = File::open(file_arg).expect("Opening file should succeed");
    let stdout = stdout().lock();

    let mut writer = BufWriter::new(stdout);
    copy(&amp;mut BufReader::new(file), &amp;mut writer)
        .expect("Printing file to stdout should succeed");

    writer.flush().expect("Flushing writer should succeed");
}
<span class="boring">}</span></code></pre></pre>
<p>The above binary is a very simple version of <code>cat</code> taking a single file
argument. The file content is read and dumped to the <code>stdout</code>. The following is
the benchmark and library code to show the different options assuming this code
is stored in a benchmark file <code>benches/lib_bench_subprocess.rs</code></p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">extern crate iai_callgrind;
</span><span class="boring">macro_rules! env { ($m:tt) =&gt; {{ "/some/path" }} }
</span>use std::hint::black_box;
use std::io;
use std::path::PathBuf;
use std::process::ExitStatus;

use iai_callgrind::{
    library_benchmark, library_benchmark_group, main, LibraryBenchmarkConfig,
    OutputFormat,
};

/// Suppose this is your library
pub mod my_lib {
    use std::io;
    use std::path::Path;
    use std::process::ExitStatus;

    /// A function executing the crate's binary `cat`
    pub fn cat(file: &amp;Path) -&gt; io::Result&lt;ExitStatus&gt; {
        std::process::Command::new(env!("CARGO_BIN_EXE_cat"))
            .arg(file)
            .status()
    }
}

/// Create a file `/tmp/foo.txt` with some content
fn create_file() -&gt; PathBuf {
    let path = PathBuf::from("/tmp/foo.txt");
    std::fs::write(&amp;path, "some content").unwrap();
    path
}

#[library_benchmark]
#[bench::some(setup = create_file)]
fn bench_subprocess(path: PathBuf) -&gt; io::Result&lt;ExitStatus&gt; {
    black_box(my_lib::cat(&amp;path))
}

library_benchmark_group!(name = my_group; benchmarks = bench_subprocess);
<span class="boring">fn main() {
</span>main!(
    config = LibraryBenchmarkConfig::default()
        .output_format(OutputFormat::default()
            .show_intermediate(true)
        );
    library_benchmark_groups = my_group
);
<span class="boring">}</span></code></pre></pre>
<p>Running the above benchmark with <code>cargo bench</code> results in the following terminal
output:</p>
<pre><code class="hljs"><span style="color:#0A0">lib_bench_subprocess::my_group::bench_subprocess</span> <span style="color:#0AA">some</span><span style="color:#0AA">:</span><b><span style="color:#00A">create_file()</span></b>
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 3141785 thread: 1 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_subprocess-a1b2e1eac5125819</span></b>
<span style="color:#555">  </span>Instructions:                        <b>4467</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                             <b>6102</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                               <b>17</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>186</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                    <b>6305</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                   <b>12697</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 3141786 thread: 1 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/cat /tmp/foo.txt</span></b>
<span style="color:#555">  </span>Instructions:                           <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                                <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                                <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                               <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                       <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                       <b>0</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>Total</b>
<span style="color:#555">  </span>Instructions:                        <b>4467</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                             <b>6102</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                               <b>17</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>186</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                    <b>6305</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                   <b>12697</b>|N/A                  (<span style="color:#555">*********</span>)</code></pre>
<p>As expected, the <code>cat</code> subprocess is not measured and the metrics are zero for
the same reasons as the initial measurement of threads.</p>
<h3 id="measuring-subprocesses-using-toggles"><a class="header" href="#measuring-subprocesses-using-toggles">Measuring subprocesses using toggles</a></h3>
<p>The great advantage over measuring threads is that each process has a main
function that is not inlined by the compiler and can serve as a reliable hook
for the <code>--toggle-collect</code> argument so the following adaption to the above
benchmark will just work:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">extern crate iai_callgrind;
</span><span class="boring">mod my_lib {
</span><span class="boring">use std::{io, path::Path, process::ExitStatus};
</span><span class="boring">pub fn cat(_: &amp;Path) -&gt; io::Result&lt;ExitStatus&gt; {
</span><span class="boring">   std::process::Command::new("some").status()
</span><span class="boring">}}
</span><span class="boring">fn create_file() -&gt; PathBuf { PathBuf::from("some") }
</span><span class="boring">use std::hint::black_box;
</span><span class="boring">use std::io;
</span><span class="boring">use std::path::PathBuf;
</span><span class="boring">use std::process::ExitStatus;
</span><span class="boring">use iai_callgrind::{
</span><span class="boring">   library_benchmark, library_benchmark_group, main, LibraryBenchmarkConfig,
</span><span class="boring">   OutputFormat,
</span><span class="boring">};
</span>#[library_benchmark(
    config = LibraryBenchmarkConfig::default()
        .callgrind_args(["--toggle-collect=cat::main"])
)]
#[bench::some(setup = create_file)]
fn bench_subprocess(path: PathBuf) -&gt; io::Result&lt;ExitStatus&gt; {
    black_box(my_lib::cat(&amp;path))
}
<span class="boring">library_benchmark_group!(name = my_group; benchmarks = bench_subprocess);
</span><span class="boring">fn main() {
</span><span class="boring">main!(library_benchmark_groups = my_group);
</span><span class="boring">}</span></code></pre></pre>
<p>producing the desired output</p>
<pre><code class="hljs"><span style="color:#0A0">lib_bench_subprocess::my_group::bench_subprocess</span> <span style="color:#0AA">some</span><span style="color:#0AA">:</span><b><span style="color:#00A">create_file()</span></b>
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 3324117 thread: 1 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_subprocess-a1b2e1eac5125819</span></b>
<span style="color:#555">  </span>Instructions:                        <b>4475</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                             <b>6112</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                               <b>14</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>187</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                    <b>6313</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                   <b>12727</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 3324119 thread: 1 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/cat /tmp/foo.txt</span></b>
<span style="color:#555">  </span>Instructions:                        <b>4019</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                             <b>5575</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                               <b>12</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>167</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                    <b>5754</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                   <b>11480</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>Total</b>
<span style="color:#555">  </span>Instructions:                        <b>8494</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                            <b>11687</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                               <b>26</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>354</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                   <b>12067</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                   <b>24207</b>|N/A                  (<span style="color:#555">*********</span>)</code></pre>
<h3 id="measuring-subprocesses-using-client-requests"><a class="header" href="#measuring-subprocesses-using-client-requests">Measuring subprocesses using client requests</a></h3>
<p>Naturally, client requests can also be used to measure subprocesses. The
callgrind client requests are added to the code of the <code>cat</code> binary:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">extern crate iai_callgrind;
</span>use std::fs::File;
use std::io::{copy, stdout, BufReader, BufWriter, Write};
use iai_callgrind::client_requests::callgrind;

<span class="boring">fn main() {
</span>fn main() {
    let mut args_iter = std::env::args().skip(1);
    let file_arg = args_iter.next().expect("File argument should be present");

    callgrind::toggle_collect();
    let file = File::open(file_arg).expect("Opening file should succeed");
    let stdout = stdout().lock();

    let mut writer = BufWriter::new(stdout);
    copy(&amp;mut BufReader::new(file), &amp;mut writer)
        .expect("Printing file to stdout should succeed");

    writer.flush().expect("Flushing writer should succeed");
    callgrind::toggle_collect();
}
<span class="boring">}</span></code></pre></pre>
<p>For the purpose of this example we decided that measuring the parsing of the
command-line-arguments is not interesting for us and excluded it from the
collected metrics. The benchmark itself is reverted to its original state
without the toggle:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">extern crate iai_callgrind;
</span><span class="boring">mod my_lib {
</span><span class="boring">use std::{io, path::Path, process::ExitStatus};
</span><span class="boring">pub fn cat(_: &amp;Path) -&gt; io::Result&lt;ExitStatus&gt; {
</span><span class="boring">   std::process::Command::new("some").status()
</span><span class="boring">}}
</span><span class="boring">fn create_file() -&gt; PathBuf { PathBuf::from("some") }
</span><span class="boring">use std::hint::black_box;
</span><span class="boring">use std::io;
</span><span class="boring">use std::path::PathBuf;
</span><span class="boring">use std::process::ExitStatus;
</span><span class="boring">use iai_callgrind::{
</span><span class="boring">   library_benchmark, library_benchmark_group, main, LibraryBenchmarkConfig,
</span><span class="boring">   OutputFormat,
</span><span class="boring">};
</span>#[library_benchmark]
#[bench::some(setup = create_file)]
fn bench_subprocess(path: PathBuf) -&gt; io::Result&lt;ExitStatus&gt; {
    black_box(my_lib::cat(&amp;path))
}
<span class="boring">library_benchmark_group!(name = my_group; benchmarks = bench_subprocess);
</span><span class="boring">fn main() {
</span><span class="boring">main!(library_benchmark_groups = my_group);
</span><span class="boring">}</span></code></pre></pre>
<p>Now, running the benchmark shows</p>
<pre><code class="hljs"><span style="color:#0A0">lib_bench_subprocess::my_group::bench_subprocess</span> <span style="color:#0AA">some</span><span style="color:#0AA">:</span><b><span style="color:#00A">create_file()</span></b>
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 3421822 thread: 1 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/deps/lib_bench_subprocess-a1b2e1eac5125819</span></b>
<span style="color:#555">  </span>Instructions:                        <b>4467</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                             <b>6102</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                               <b>17</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>186</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                    <b>6305</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                   <b>12697</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>pid: 3421823 thread: 1 part: 1</b>        |N/A
<span style="color:#555">  </span>Command:             <b><span style="color:#00A">target/release/cat /tmp/foo.txt</span></b>
<span style="color:#555">  </span>Instructions:                        <b>2429</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                             <b>3406</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                                <b>8</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>138</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                    <b>3552</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                    <b>8276</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span><span style="color:#A50">##</span> <b>Total</b>
<span style="color:#555">  </span>Instructions:                        <b>6896</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L1 Hits:                             <b>9508</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>L2 Hits:                               <b>25</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>RAM Hits:                             <b>324</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Total read+write:                    <b>9857</b>|N/A                  (<span style="color:#555">*********</span>)
<span style="color:#555">  </span>Estimated Cycles:                   <b>20973</b>|N/A                  (<span style="color:#555">*********</span>)</code></pre>
<p>As expected, the metrics for the <code>cat</code> binary are a little bit lower since we
skipped measuring the parsing of the command-line arguments.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../benchmarks/library_benchmarks/custom_entry_point.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../benchmarks/library_benchmarks/examples.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../benchmarks/library_benchmarks/custom_entry_point.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../benchmarks/library_benchmarks/examples.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../js/dropdown.js"></script>


    </div>
    </body>
</html>
