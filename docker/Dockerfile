ARG GUNGRAUN_CROSS_TARGET=x86_64-unknown-linux-gnu
ARG GUNGRAUN_CROSS_VALGRIND_VERSION=3.25.1

FROM ghcr.io/cross-rs/${GUNGRAUN_CROSS_TARGET}:main
ARG DEBIAN_FRONTEND=noninteractive

ARG GUNGRAUN_CROSS_VALGRIND_VERSION
COPY prepare_valgrind.sh /
RUN /prepare_valgrind.sh

ARG GUNGRAUN_CROSS_VALGRIND_VERSION
ARG GUNGRAUN_CROSS_TARGET
COPY build_valgrind.sh /
RUN /build_valgrind.sh

COPY cleanup_valgrind.sh /
RUN /cleanup_valgrind.sh

ARG GUNGRAUN_CROSS_TARGET
COPY build_custom_image.sh /
RUN /build_custom_image.sh

ARG GUNGRAUN_CROSS_TARGET
ENV GUNGRAUN_CROSS_TARGET=${GUNGRAUN_CROSS_TARGET}
ENV GUNGRAUN_CROSS_VALGRIND_DESTDIR="/target/valgrind/${GUNGRAUN_CROSS_TARGET}"
ENV GUNGRAUN_CROSS_VALGRIND_TEMPDIR="/valgrind/target"
